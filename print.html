<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCG Card Image Upload & Print Template</title>
    <style>
        @page {
            size: A4;
            margin: 0.4in;
        }
        
        @page :left {
            margin: 0.4in 0.35in 0.4in 0.45in; /* top right bottom left - compensate for duplex shift */
        }
        
        @page :right {
            margin: 0.4in 0.45in 0.4in 0.35in; /* top right bottom left - compensate for duplex shift */
        }
        
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .card-sheet {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 7.7in;
            height: 10.2in;
            margin: 0 auto;
        }
        
        .card-slot {
            width: 2.5in;
            height: 3.4in;
            border: 2px dashed #ccc;
            border-radius: 15px;
            position: relative;
            background: #fafafa;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            page-break-inside: avoid;
            overflow: hidden;
        }
        
        .card-slot:hover {
            border-color: #4CAF50;
            background: #f8fff8;
        }
        
        .card-slot.has-image {
            border: none;
            background: white;
            cursor: default;
        }
        
        .card-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 15px;
            display: none;
            background: white;
        }
        
        .card-slot.has-image .card-image {
            display: block;
        }
        
        .upload-placeholder {
            text-align: center;
            color: #666;
            padding: 20px;
        }
        
        .card-slot.has-image .upload-placeholder {
            display: none;
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
            color: #ccc;
        }
        
        .upload-text {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .upload-subtext {
            font-size: 11px;
            color: #999;
        }
        
        .file-input {
            display: none;
        }
        
        .controls {
            margin-bottom: 20px;
            text-align: center;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .controls button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }
        
        .controls button:hover {
            background: #45a049;
        }
        
        .controls button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .clear-btn {
            background: #f44336 !important;
        }
        
        .clear-btn:hover {
            background: #da190b !important;
        }
        
        .instructions {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
        
        .card-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }
        
        .card-slot:hover .card-controls {
            opacity: 1;
        }
        
        .card-slot.has-image:hover .card-controls {
            opacity: 1;
        }
        
        .control-btn {
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            margin-left: 2px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover {
            background: rgba(0,0,0,0.9);
        }
        
        .stats {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-item {
            display: inline-block;
            margin: 0 15px;
            font-size: 14px;
        }
        
        .stat-number {
            font-weight: bold;
            color: #4CAF50;
            font-size: 18px;
        }
        
        .fit-options {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .fit-options label {
            margin: 0 10px;
            font-size: 14px;
        }
        
        .fit-options input[type="radio"] {
            margin-right: 5px;
        }
        
        @media print {
            body { 
                background: white; 
                padding: 0;
            }
            .controls, .instructions, .stats, .fit-options { 
                display: none; 
            }
            .card-sheet { 
                gap: 2mm; 
                margin: 0;
                max-width: none;
                height: auto;
            }
            .card-slot {
                border: none;
                break-inside: avoid;
            }
            .card-controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="instructions">
        <h3>üÉè TCG Card Image Upload & Print Template</h3>
        <p><strong>1.</strong> Click on any card slot to upload your card image<br>
        <strong>2.</strong> Supports JPG, PNG, WebP formats<br>
        <strong>3.</strong> Images will auto-resize to fit card dimensions (2.5" √ó 3.4")<br>
        <strong>4.</strong> Print on cardstock (250-300gsm) for best results<br>
        <strong>5.</strong> Images will maintain their aspect ratio</p>
    </div>

    <div class="fit-options">
        <strong>Image Fit Options:</strong>
        <label><input type="radio" name="fitOption" value="contain" checked> Fit Entire Image (no cropping)</label>
        <label><input type="radio" name="fitOption" value="cover"> Fill Slot (may crop)</label>
        <label><input type="radio" name="fitOption" value="fill"> Stretch to Fill</label>
    </div>

    <div class="stats">
        <div class="stat-item">
            <div class="stat-number" id="uploadedCount">0</div>
            <div>Cards Uploaded</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">9</div>
            <div>Total Slots</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">2.5" √ó 3.4"</div>
            <div>Card Size</div>
        </div>
    </div>

    <div class="controls">
        <button onclick="uploadMultiple()">üìÅ Upload Multiple Cards</button>
        <button onclick="window.print()" id="printBtn" disabled>üñ®Ô∏è Print Cards</button>
        <button onclick="clearAll()" class="clear-btn">üóëÔ∏è Clear All</button>
        <button onclick="addSheet()">‚ûï Add New Sheet</button>
        <button onclick="toggleDuplexMode()" id="duplexBtn">üîÑ Enable Duplex Mode</button>
        <!-- button for going back to index.html -->
        <button onclick="window.location.href='index.html'">üîô Back to Editor</button>
    </div>

    <div class="card-sheet" id="cardSheet">
        <!-- Card slots will be generated by JavaScript -->
    </div>

    <input type="file" id="multipleFileInput" class="file-input" multiple accept="image/*">

    <script>
        let uploadedCards = 0;
        const maxCards = 9;

        // Initialize card slots
        function initializeCards() {
            const sheet = document.getElementById('cardSheet');
            sheet.innerHTML = '';
            
            for (let i = 0; i < maxCards; i++) {
                const cardSlot = createCardSlot(i);
                sheet.appendChild(cardSlot);
            }
            updateStats();
        }

        function createCardSlot(index) {
            const cardSlot = document.createElement('div');
            cardSlot.className = 'card-slot';
            cardSlot.innerHTML = `
                <div class="card-controls">
                    <button class="control-btn" onclick="replaceCard(${index})" title="Replace">üîÑ</button>
                    <button class="control-btn" onclick="removeCard(${index})" title="Remove">‚úï</button>
                </div>
                <img class="card-image" alt="Card ${index + 1}">
                <div class="upload-placeholder">
                    <div class="upload-icon">üÉè</div>
                    <div class="upload-text">Click to Upload Card</div>
                    <div class="upload-subtext">JPG, PNG, WebP</div>
                </div>
                <input type="file" class="file-input" accept="image/*" onchange="handleCardUpload(event, ${index})">
            `;
            
            cardSlot.addEventListener('click', function(e) {
                if (e.target.closest('.card-controls')) {
                    return;
                }
                cardSlot.querySelector('.file-input').click();
            });
            
            return cardSlot;
        }

        function handleCardUpload(event, index) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const cardSlot = document.querySelectorAll('.card-slot')[index];
                const img = cardSlot.querySelector('.card-image');
                
                img.src = e.target.result;
                cardSlot.classList.add('has-image');
                
                if (!cardSlot.dataset.hasImage) {
                    uploadedCards++;
                    cardSlot.dataset.hasImage = 'true';
                }
                
                updateStats();
            };
            reader.readAsDataURL(file);
        }

        function removeCard(index) {
            const cardSlot = document.querySelectorAll('.card-slot')[index];
            const img = cardSlot.querySelector('.card-image');
            const fileInput = cardSlot.querySelector('.file-input');
            
            img.src = '';
            cardSlot.classList.remove('has-image');
            fileInput.value = '';
            
            if (cardSlot.dataset.hasImage) {
                uploadedCards--;
                delete cardSlot.dataset.hasImage;
            }
            
            updateStats();
        }

        function replaceCard(index) {
            const cardSlot = document.querySelectorAll('.card-slot')[index];
            cardSlot.querySelector('.file-input').click();
        }

        function uploadMultiple() {
            document.getElementById('multipleFileInput').click();
        }

        document.getElementById('multipleFileInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const cardSlots = document.querySelectorAll('.card-slot');
            let emptySlots = [];
            
            // Find empty slots
            cardSlots.forEach((slot, index) => {
                if (!slot.classList.contains('has-image')) {
                    emptySlots.push(index);
                }
            });
            
            // Upload files to empty slots
            files.forEach((file, fileIndex) => {
                if (fileIndex < emptySlots.length) {
                    const slotIndex = emptySlots[fileIndex];
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const cardSlot = cardSlots[slotIndex];
                        const img = cardSlot.querySelector('.card-image');
                        
                        img.src = event.target.result;
                        cardSlot.classList.add('has-image');
                        
                        if (!cardSlot.dataset.hasImage) {
                            uploadedCards++;
                            cardSlot.dataset.hasImage = 'true';
                        }
                        
                        updateStats();
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            if (files.length > emptySlots.length) {
                alert(`Only ${emptySlots.length} empty slots available. ${files.length - emptySlots.length} files were not uploaded.`);
            }
            
            // Clear the input
            this.value = '';
        });

        function clearAll() {
            if (confirm('Remove all uploaded cards?')) {
                document.querySelectorAll('.card-slot').forEach((slot, index) => {
                    removeCard(index);
                });
            }
        }

        function addSheet() {
            const newSheet = document.createElement('div');
            newSheet.className = 'card-sheet';
            newSheet.style.marginTop = '40px';
            newSheet.style.pageBreakBefore = 'always';
            
            for (let i = 0; i < maxCards; i++) {
                const cardSlot = createCardSlot(i + document.querySelectorAll('.card-slot').length);
                newSheet.appendChild(cardSlot);
            }
            
            document.body.appendChild(newSheet);
        }

        let duplexMode = false;
        function toggleDuplexMode() {
            duplexMode = !duplexMode;
            const btn = document.getElementById('duplexBtn');
            const sheets = document.querySelectorAll('.card-sheet');
            
            if (duplexMode) {
                btn.textContent = 'üîÑ Disable Duplex Mode';
                btn.style.background = '#ff9800';
                // Add slight offset for duplex printing
                sheets.forEach((sheet, index) => {
                    if (index % 2 === 1) { // Back pages
                        sheet.style.marginLeft = '-2mm';
                    }
                });
            } else {
                btn.textContent = 'üîÑ Enable Duplex Mode';
                btn.style.background = '#4CAF50';
                // Remove offset
                sheets.forEach(sheet => {
                    sheet.style.marginLeft = '0';
                });
            }
        }

        function updateStats() {
            document.getElementById('uploadedCount').textContent = uploadedCards;
            document.getElementById('printBtn').disabled = uploadedCards === 0;
        }

        // Handle fit option changes
        document.querySelectorAll('input[name="fitOption"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const fitValue = this.value;
                document.querySelectorAll('.card-image').forEach(img => {
                    img.style.objectFit = fitValue;
                });
            });
        });

        // Initialize the page
        initializeCards();

        // Drag and drop functionality
        document.addEventListener('dragover', function(e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            
            if (files.length > 0) {
                const emptySlots = Array.from(document.querySelectorAll('.card-slot:not(.has-image)'));
                
                files.forEach((file, index) => {
                    if (index < emptySlots.length) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            const img = emptySlots[index].querySelector('.card-image');
                            img.src = event.target.result;
                            emptySlots[index].classList.add('has-image');
                            
                            if (!emptySlots[index].dataset.hasImage) {
                                uploadedCards++;
                                emptySlots[index].dataset.hasImage = 'true';
                            }
                            
                            updateStats();
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        });
    </script>
</body>
</html>